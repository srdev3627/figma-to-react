<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
<div class="layout">
  <p id="generated-code" class="jsx"></p>
  <div id="switch-css-format">
    <input type="radio" name="css-style" id="css" value="css" checked />
    <label for="css">CSS</label>

    <input type="radio" name="css-style" id="styled-components" value="styled-components" />
    <label for="styled-components">styled-components</label>
  </div>
  <div id="switch-unit-type">
    <input type="radio" name="unit-type" id="px" value="px" checked />
    <label for="px">px</label>

    <input type="radio" name="unit-type" id="rem" value="rem" />
    <label for="rem">rem</label>

    <input type="radio" name="unit-type" id="remAs10px" value="remAs10px" />
    <label for="remAs10px">rem(as 10px)</label>
  </div>
  <div class="button-layout">
    <button id="copy-button" class="copy-button">Copy to clipboard</button>
  </div>

  <div id="app" />
</div>

<style>
  * {
    font-family: sans-serif;
    color: #424347;
    box-sizing: border-box;
  }
  body {
    padding: 0;
    margin: 0;
  }
  p {
    margin: 0;
  }

  .layout {
    padding: 20px;
    background-color: #f0f0f0;
    height: 100%;
  }

  #generated-code {
    background-color: #1d1d1d;
    border-radius: 8px;
    border: 2px #ddd solid;
    padding: 16px 20px;
    width: 100%;

    font-family: 'Fira Code', monospace;
    font-size: 14px;
    color: #5497c3;
    white-space: pre-wrap;

    max-height: 280px;
    overflow: auto;
  }

  #switch-css-format {
    margin-top: 12px;
  }

  #switch-unit-type {
    margin-top: 12px;
  }

  .button-layout {
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }
  .copy-button {
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    background-color: #16949f;
    color: #fff;
    cursor: pointer;
  }

  .default-text {
    color: #5497c3;
  }
  .variable-name {
    color: #cccca8;
  }
  .function-text {
    color: #93c3ef;
  }
  .return-text {
    color: #b586b2;
  }
  .expression-text {
    color: #fff;
  }
  .type-text {
    color: #4fccb0;
  }
  .tag-text {
    color: #777;
  }
  .tag-name-text {
    color: #4fccb0;
  }
  .string-text {
    color: #cb9178;
  }
</style>
<script>
  function escapeHtml(str) {
    str = str.replace(/&/g, '&amp;')
    str = str.replace(/</g, '&lt;')
    str = str.replace(/>/g, '&gt;')
    str = str.replace(/"/g, '&quot;')
    str = str.replace(/'/g, '&#39;')
    return str
  }

  document.getElementsByName('css-style').forEach((r) => r.addEventListener('change', (e) => notifyChangeCssStyle(e.target.value)))
  document.getElementsByName('unit-type').forEach((r) => r.addEventListener('change', (e) => notifyChangeUnitType(e.target.value)))

  function notifyChangeCssStyle(newStyle) {
    parent.postMessage({ pluginMessage: { type: 'new-css-style-set', cssStyle: newStyle } }, '*')
  }

  function notifyChangeUnitType(newUnitType) {
    parent.postMessage({ pluginMessage: { type: 'new-unit-type-set', unitType: newUnitType } }, '*')
  }

  onmessage = (event) => {
    document.getElementsByName('css-style').forEach((elem) => {
      if (elem.value === event.data.pluginMessage.cssStyle) {
        elem.checked = true
      }
    })

    document.getElementsByName('unit-type').forEach((elem) => {
      if (elem.value === event.data.pluginMessage.unitType) {
        elem.checked = true
      }
    })

    const codeStr = event.data.pluginMessage.generatedCodeStr + '\n\n' + event.data.pluginMessage.cssString
    const generatedCodeElement = document.getElementById('generated-code')
    generatedCodeElement.innerHTML = insertSyntaxHighlightText(escapeHtml(codeStr))

    document.getElementById('copy-button').addEventListener('click', () => {
      const listener = (e) => {
        e.clipboardData.setData('text/plain', codeStr)
        e.preventDefault()
        parent.postMessage({ pluginMessage: { type: 'notify-copy-success' } }, '*')
      }

      document.addEventListener('copy', listener)
      document.execCommand('copy')
    })
  }

  // I tried to use highlight.js https://highlightjs.readthedocs.io/en/latest/index.html
  // but didn't like the color. so I give it a go for this dirty styleðŸ’ª
  function insertSyntaxHighlightText(text) {
    return text
      .replaceAll('const', 'const <span class="variable-name">')
      .replaceAll(': React.VFC', '</span>: React.VFC')
      .replaceAll('= styled.', '</span>= styled.')
      .replaceAll('React.VFC', '<span class="type-text">React.VFC</span>')
      .replaceAll('return', '<span class="return-text">return</span>')
      .replaceAll(': ', '<span class="expression-text">: </span>')
      .replaceAll('= ()', '<span class="expression-text">= ()</span>')
      .replaceAll('{', '<span class="expression-text">{</span>')
      .replaceAll('}', '<span class="expression-text">}</span>')
      .replaceAll('(', '<span class="expression-text">(</span>')
      .replaceAll(')', '<span class="expression-text">)</span>')
      .replaceAll('&lt;', '<span class="tag-text">&lt;</span><span class="tag-name-text">')
      .replaceAll('&gt;', '</span><span class="tag-text">&gt;</span>')
      .replaceAll('=</span><span class="tag-text">&gt;</span>', '<span class="default-text">=&gt;</span>')
      .replaceAll('.div', '<span class="function-text">.div</span>')
      .replaceAll('`', '<span class="string-text">`</span>')
  }
</script>
